services:
  db:
    image: postgres:16
    environment:
      POSTGRES_DB: gitea
      POSTGRES_USER: gitea
      POSTGRES_PASSWORD: your_secure_password_here # change password
    volumes:
      - ./postgres:/var/lib/postgresql/data
    networks:
      - gitea
    restart: unless-stopped

  gitea:
    image: gitea/gitea:latest-rootless
    user: "1000:1000"
    environment:
      - GITEA__server__PROTOCOL=http
      - GITEA__server__HTTP_ADDR=0.0.0.0
      - GITEA__server__HTTP_PORT=3000
      - GITEA__server__ROOT_URL=https://git.yourdomain.org/ # Change to your domain
      - GITEA__service__DISABLE_REGISTRATION=false
      - GITEA__service__REQUIRE_SIGNIN_VIEW=false
    volumes:
      - ./data:/var/lib/gitea
      - ./config:/etc/gitea
    ports:
      - "127.0.0.1:3000:3000"
    networks:
      - gitea
    depends_on:
      - db
    restart: unless-stopped

networks:
  gitea:
    driver: bridge